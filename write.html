<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>새 글 작성 - My Blog</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <h1 class="logo"><a href="index.html">My Blog</a></h1>
            <nav class="tag-nav">
                <a href="index.html" class="nav-tag all">전체</a>
                <a href="index.html?category=tech" class="nav-tag tech">기술</a>
                <a href="index.html?category=life" class="nav-tag life">일상</a>
                <a href="index.html?category=travel" class="nav-tag travel">여행</a>
            </nav>
        </div>
    </header>

    <div class="write-container">
        <div class="write-page">
            <div class="write-header">
                <h1 id="page-title">새 글 작성</h1>
            </div>

            <form id="write-form">
                <div class="form-group">
                    <label for="post-title-input">제목</label>
                    <input type="text" id="post-title-input" placeholder="글 제목을 입력하세요" required>
                </div>

                <div class="form-group">
                    <label>카테고리</label>
                    <div class="tag-selector">
                        <input type="checkbox" id="tag-tech" name="category" value="tech">
                        <label for="tag-tech" class="tag-label tech">기술</label>

                        <input type="checkbox" id="tag-life" name="category" value="life">
                        <label for="tag-life" class="tag-label life">일상</label>

                        <input type="checkbox" id="tag-travel" name="category" value="travel">
                        <label for="tag-travel" class="tag-label travel">여행</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>대표 이미지</label>
                    <div class="image-upload-area" id="image-upload-area">
                        <input type="file" id="image-input" accept="image/*" hidden>
                        <div class="image-preview" id="image-preview">
                            <span class="upload-placeholder">클릭하여 이미지 선택</span>
                        </div>
                        <button type="button" class="btn-remove-image" id="btn-remove-image" style="display:none;">이미지 삭제</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post-body-input">내용</label>
                    <textarea id="post-body-input" rows="20" placeholder="글 내용을 입력하세요" required></textarea>
                </div>

                <div class="form-actions">
                    <a href="index.html" class="btn btn-cancel">취소</a>
                    <button type="submit" class="btn btn-submit">발행하기</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 My Blog. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        // 편집 모드 확인
        const urlParams = new URLSearchParams(window.location.search);
        const editId = urlParams.get('edit');
        let isEditMode = false;
        let currentImage = null;

        // 이미지 업로드 관련 요소
        const imageInput = document.getElementById('image-input');
        const imagePreview = document.getElementById('image-preview');
        const imageUploadArea = document.getElementById('image-upload-area');
        const btnRemoveImage = document.getElementById('btn-remove-image');

        // 이미지 프리뷰 클릭 시 파일 선택
        imagePreview.addEventListener('click', () => imageInput.click());

        // 이미지 선택 시 프리뷰 표시
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('이미지 크기는 2MB 이하여야 합니다.');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImage = e.target.result;
                    imagePreview.innerHTML = `<img src="${currentImage}" alt="미리보기">`;
                    btnRemoveImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // 이미지 삭제
        btnRemoveImage.addEventListener('click', function() {
            currentImage = null;
            imageInput.value = '';
            imagePreview.innerHTML = '<span class="upload-placeholder">클릭하여 이미지 선택</span>';
            btnRemoveImage.style.display = 'none';
        });

        // 편집 모드일 경우 기존 글 불러오기
        if (editId) {
            isEditMode = true;
            const savedPosts = JSON.parse(localStorage.getItem('blogPosts') || '[]');
            const postToEdit = savedPosts.find(p => p.id === editId);

            if (postToEdit) {
                document.getElementById('page-title').textContent = '글 수정';
                document.getElementById('post-title-input').value = postToEdit.title;
                document.getElementById('post-body-input').value = postToEdit.content;

                // 태그 체크
                postToEdit.tags.forEach(tag => {
                    const checkbox = document.getElementById(`tag-${tag}`);
                    if (checkbox) checkbox.checked = true;
                });

                // 기존 이미지 불러오기
                if (postToEdit.image) {
                    currentImage = postToEdit.image;
                    imagePreview.innerHTML = `<img src="${currentImage}" alt="미리보기">`;
                    btnRemoveImage.style.display = 'block';
                }

                // 버튼 텍스트 변경
                document.querySelector('.btn-submit').textContent = '수정하기';
            }
        }

        // 글쓰기/수정 폼 제출
        document.getElementById('write-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('post-title-input').value;
            const content = document.getElementById('post-body-input').value;

            // 선택된 태그들 가져오기
            const selectedTags = [];
            document.querySelectorAll('.tag-selector input:checked').forEach(input => {
                selectedTags.push(input.value);
            });

            if (selectedTags.length === 0) {
                alert('카테고리를 하나 이상 선택해주세요.');
                return;
            }

            let savedPosts = JSON.parse(localStorage.getItem('blogPosts') || '[]');

            if (isEditMode) {
                // 수정 모드: 기존 글 업데이트
                const index = savedPosts.findIndex(p => p.id === editId);
                if (index !== -1) {
                    savedPosts[index] = {
                        ...savedPosts[index],
                        title: title,
                        tags: selectedTags,
                        content: content,
                        image: currentImage
                    };
                }
            } else {
                // 새 글 작성
                const newPost = {
                    id: 'user-' + Date.now(),
                    title: title,
                    tags: selectedTags,
                    content: content,
                    image: currentImage,
                    date: new Date().toISOString()
                };
                savedPosts.unshift(newPost);
            }

            localStorage.setItem('blogPosts', JSON.stringify(savedPosts));

            // 메인 페이지로 이동
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>
